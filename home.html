{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="page-header">
    <h1>Dashboard</h1>
    <p class="subtitle">Your decision intelligence overview</p>
</div>

<!-- ===================== -->
<!-- STATS GRID -->
<!-- ===================== -->
<div class="grid grid-4">

    <div class="stat-card info">
        <h3>Total Datasets</h3>
        <p>{{ total_datasets }}</p>
    </div>

    <div class="stat-card success">
        <h3>Processed</h3>
        <p>{{ processed_datasets }}</p>
    </div>

    <div class="stat-card warning">
        <h3>Pending</h3>
        <p>{{ pending_datasets }}</p>
    </div>

    <div class="stat-card info">
        <h3>Total Decisions</h3>
        <p>{{ total_decisions }}</p>
    </div>

</div>

<!-- ===================== -->
<!-- ACTIONS -->
<!-- ===================== -->
<div class="action-bar">
    <a href="{% url 'datasets:upload' %}" class="btn btn-success">
        Upload Dataset
    </a>
    <a href="{% url 'datasets:dataset_list' %}" class="btn btn-primary">
        View Datasets
    </a>
</div>

<!-- ===================== -->
<!-- ANALYTICS / CHARTS -->
<!-- ===================== -->
<div class="section">
    <h2>Analytics</h2>

    {% if confidence_chart %}
        <div class="card">
            <h3>Decision Confidence Distribution</h3>

            <!-- Chart -->
            <div class="chart-box">
            <img src="/media/{{ confidence_chart }}" alt="Confidence Chart">
            </div>
            <!-- Clickable confidence filters -->
            <div class="confidence-links">
                <a href="{% url 'decisions:filtered' %}?confidence=high" class="badge badge-success">
                    High Confidence
                </a>
                <a href="{% url 'decisions:filtered' %}?confidence=medium" class="badge badge-warning">
                    Medium Confidence
                </a>
                <a href="{% url 'decisions:filtered' %}?confidence=low" class="badge badge-danger">
                    Low Confidence
                </a>
            </div>

            <p class="insight">
                <strong>Key takeaway:</strong>
                    Most high-confidence decisions are generated from Finance datasets.
            </p>

            <p class="meta">
                Drives: <strong>Financial risk & cost control actions</strong>
            </p>
        </div>
    {% endif %}



    {% if trend_chart %}
        <div class="card">
            <h3>Decisions per Dataset</h3>
            <div class="chart-box">
            <img src="/media/{{ trend_chart }}" alt="Trend Chart">
            </div>
            <p class="insight">
                <strong>Key takeaway:</strong>
                Certain datasets are generating more decisions, indicating higher complexity.
            </p>

            <p class="meta">
                Drives: <strong>Audit & prioritization of datasets</strong>
            </p>
        </div>
    {% endif %}


    {% if domain_chart %}
        <div class="card">
            <h3>Domain-wise Decisions</h3>
            <div class="chart-box">
            <img src="/media/{{ domain_chart }}" alt="Domain Chart">
            </div>
            <p class="insight">
                <strong>Key takeaway:</strong>
                Finance and Sales domains require the most strategic attention.
            </p>

            <p class="meta">
                Drives: <strong>Domain-level strategic planning</strong>
            </p>

            <small class="muted">
                Use filters below to explore domain-specific decisions.
            </small>

            <div class="action-bar">
                <a href="{% url 'decisions:filtered' %}?domain=sales" class="btn btn-primary">
                    View Sales Decisions
                </a>

                <a href="{% url 'decisions:filtered' %}?domain=marketing" class="btn btn-success">
                    View Marketing Decisions
                </a>

                <a href="{% url 'decisions:filtered' %}?domain=finance" class="btn btn-danger">
                    View Finance Decisions
                </a>
            </div>
        </div>
    {% endif %}



<!-- ===================== -->
<!-- RECENT DECISIONS -->
<!-- ===================== -->
<div class="section">
    <h2>Recent Decisions</h2>

    {% if recent_decisions %}
        <div class="list">
            {% for d in recent_decisions %}
                <div class="list-item">
                    <strong>{{ d.title }}</strong>
                    <p>{{ d.recommendation }}</p>
                    <small class="muted">
                        Dataset: {{ d.dataset.name }}
                    </small>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="empty-text">No decisions generated yet.</p>
    {% endif %}
</div>

<!-- ===================== -->
<!-- RECENT DATASETS -->
<!-- ===================== -->
<div class="section">
    <h2>Your Recent Datasets</h2>

    {% if recent_datasets %}
        <div class="list">
            {% for ds in recent_datasets %}
                <div class="list-item">
                    <strong>{{ ds.name }}</strong><br>
                    <small>
                        Type: {{ ds.type }} |
                        {{ ds.uploaded_at|date:"d M Y" }}
                    </small>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="empty-text">No datasets uploaded yet.</p>
    {% endif %}
</div>

{% endblock %}
